sudo: false
language: generic

cache:
  directories:
    - $HOME/.stack

addons:
  apt:
    packages:
      - libgmp-dev

before_install:
 - mkdir -p ~/.local/bin
 - export PATH=$HOME/.local/bin:$PATH
 - travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'

matrix:
  include:
    - name: "hs/avers"
      install:
        - cd pkg/hs/avers
        - stack --no-terminal --install-ghc test --only-dependencies
      script:
        - stack --no-terminal test --haddock --no-haddock-deps

    - name: "hs/avers-api"
      install:
        - cd pkg/hs/avers-api
        - stack --no-terminal --install-ghc test --only-dependencies
      script:
        - stack --no-terminal test --haddock --no-haddock-deps

    - name: "hs/avers-api-docs"
      install:
        - cd pkg/hs/avers-api-docs
        - stack --no-terminal --install-ghc test --only-dependencies
      script:
        - stack --no-terminal test --haddock --no-haddock-deps

    - name: "hs/avers-server"
      install:
        - cd pkg/hs/avers-server
        - stack --no-terminal --install-ghc test --only-dependencies
      script:
        - stack --no-terminal test --haddock --no-haddock-deps

    - name: "js/avers"
      language: node_js
      node_js:
        - "10"
      install:
        - cd pkg/js/avers
        - npm ci
      script:
        - node_modules/.bin/tslint --project tsconfig.json
        - node_modules/.bin/tsc --module commonjs --esModuleInterop
        - node_modules/.bin/mocha dist
